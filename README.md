# Игра Bang

## Оглавление

1. [Обзор](#обзор)  
2. [Диаграммы (Общие)](#2-диаграммы-общие)  
   2.1. [Общая диаграмма архитектуры](#21-общая-диаграмма-архитектуры)  
   2.2. [Диаграмма последовательности: Взаимодействие клиента с игровыми компонентами](#22-диаграмма-последовательности-взаимодействие-клиента-с-игровыми-компонентами)  
   2.3. [Диаграмма компонентов бизнес-логики](#23-диаграмма-компонентов-бизнес-логики)  
   2.4. [Диаграмма взаимодействия клиента с основными компонентами бизнес-логики и серверными компонентами](#24-диаграмма-взаимодействия-клиента-с-основными-компонентами-бизнес-логики-и-серверными-компонентами)  
3. [Диаграммы отдельных событий / процессов](#3-диаграммы-отдельных-событий--процессов)  
   3.1. [Диаграмма активности: Процесс авторизации игрока в системе](#31-диаграмма-активности-процесс-авторизации-игрока-в-системе)  
   3.2. [Диаграмма активности: Запрос страницы пользователем](#32-диаграмма-активности-запрос-страницы-пользователем)  
4. [Как запустить](#как-запустить)  
5. [Лицензия](#лицензия)

---

## Обзор

Основная цель движка — управление игровым процессом, валидация событий, обработка действий игроков и организация взаимодействия между клиентами и сервером. Система построена таким образом, чтобы каждый компонент отвечал за свою часть логики, а события запускали соответствующие процессы.

Вся игровая логика построена вокруг событий, таких как "карточный ход", "окончание хода" и другие, которые обрабатываются через систему событий и передаются между различными компонентами.

---

## 2. Диаграммы (Общие)

### 2.1 Общая диаграмма архитектуры

![Диаграмма](./public/docs/diagrams/view/GeneralConceptEngine.png)

Эта диаграмма даёт общий обзор архитектуры игры, включая основные компоненты, их взаимодействия и связи. В ней показаны компоненты, управляющие сессиями игры, состоянием игроков и картами, а также система событий, координирующая действия.

### 2.2 Диаграмма последовательности: Взаимодействие клиента с игровыми компонентами

![Диаграмма](./public/docs/diagrams/view/sequenceDiagramsBrief.png)

Диаграмма показывает процесс взаимодействия клиента с сервером.

### 2.3 Диаграмма компонентов бизнес-логики

![Диаграмма](./public/docs/diagrams/view/componentsDrowIo.png)

Показывает структуру компонентов бизнес-логики, которые обрабатывают игровые события, управляют состоянием игры и игроков, а также взаимодействуют через систему событий.

### 2.4 Диаграмма взаимодействия клиента с основными компонентами бизнес-логики и серверными компонентами

![Диаграмма](./public/docs/diagrams/view/sequenceDiagramGameComponents.svg)

Иллюстрирует, как клиент взаимодействует с сервером и основными игровыми компонентами, включая обработку событий и обмен данными.

---

## 3. Диаграммы отдельных событий / процессов

### 3.1 Диаграмма активности: Процесс авторизации игрока в системе

![Диаграмма](./public/docs/diagrams/view/activityDiagramAuth.svg)

Диаграмма отражает процесс авторизации игрока, основанный на событии авторизации, обрабатываемом `AuthSystem`. Система получает и разбирает событие, проверяет его наличие, после чего выполняет авторизацию с использованием данных из `GameRoom` и `ConnectedUsers`.

#### Основные этапы процесса

- Получение и разбор события авторизации в `AuthSystem`  
- Проверка регистрации события в системе  
- Получение данных для авторизации (имя, "админ код", ID сессии)  
- Если передан `sessionId`:  
  - Поиск игрока по `sessionId` в списке подключённых пользователей  
  - Проверка актуальности сессии  
  - Если сессия неактуальна — установка актуальной сессии и успешное завершение  
  - Если сессия уже существует — ошибка "Игрок с таким именем уже подключен"  
- Если `sessionId` нет или игрок не найден:  
  - Проверка корректности имени  
  - Поиск игрока по имени  
  - Проверка актуальной сессии для найденного игрока  
  - Если сессия неактуальна — установка сессии и завершение авторизации  
  - Если сессия уже существует — ошибка "Игрок с таким именем уже подключен"  
- Если игрок по имени не найден:  
  - Проверка наличия свободных мест для новых игроков  
  - Создание нового подключённого пользователя  
  - Добавление нового игрока в список подключённых  
  - Установка актуальной сессии и подтверждение авторизации  

#### Компоненты

- `EventSystem` — инициатор обработки события  
- `AuthSystem` — обрабатывает событие авторизации и управляет проверкой и установкой сессий  
- `GameRoom` — предоставляет данные для авторизации и взаимодействует с `AuthSystem`  
- `ConnectedUsers` — хранит список текущих подключённых игроков и управляет их состояниями  

#### Возможные ошибки в процессе

- Событие авторизации не зарегистрировано в системе  
- Нет данных для входа по идентификатору сессии  
- Некорректное или отсутствующее имя  
- Игрок с таким именем уже подключён (активная сессия существует)  
- Нет свободного места для подключения новых игроков  
- Не удалось создать нового подключённого пользователя  
- Не удалось добавить нового игрока в список подключённых  

---

### 3.2 Диаграмма активности: Запрос страницы пользователем

![Диаграмма](./public/docs/diagrams/view/activityDiagramUserRequestsPage.svg)

Диаграмма описывает процесс обработки запроса страницы от пользователя в событийной архитектуре. Показывает, как система обрабатывает событие, выполняет авторизацию (если требуется), маршрутизирует и рендерит нужную страницу с учётом роли пользователя и корректности данных.

#### Основные этапы процесса "Запрос страницы пользователем"

- Получение события `Получить страницу` через `EventSystem`  
- Проверка регистрации события в системе  
- Передача запроса в `PageRouter` для выбора страницы  
- Извлечение данных авторизации (имя, admin-код, ID сессии)  
- Авторизация пользователя через `GameRoom`  
- В зависимости от результата:  
  - Если не авторизован — рендерится страница авторизации  
  - Если авторизован:  
    - Рендерится страница игровой комнаты  
    - Проверяется корректность admin-кода  
    - При корректном коде добавляется блок управления  

#### Компоненты "Запрос страницы пользователем"

- `EventSystem` — инициатор обработки события  
- `PageRouter` — определяет, какую страницу рендерить  
- `GameRoom` — отвечает за авторизацию и проверку admin-кода  
- `RenderPage` — формирует HTML-страницу на основе данных  

#### Возможные ошибки в процессе "Запрос страницы пользователем"

- Событие "Получить страницу" не зарегистрировано в системе  
- Не удалось отрендерить страницу  

---

## Как запустить

Для запуска и тестирования проекта следуйте инструкциям по установке зависимостей и настройке серверного окружения. Подробнее — в файле INSTALL.md.

---

## Лицензия

Проект распространяется под лицензией MIT. См. файл LICENSE для подробностей.
